---
phase: 05-display-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/critique-display.tsx
  - src/app/page.tsx
autonomous: true

must_haves:
  truths:
    - "Critique displays in 4 distinct sections: What Works, Usability Risks, Visual Hierarchy Issues, Concrete Improvements"
    - "Each section shows scannable summary bullets that expand to show detail when clicked"
    - "Loading state shows animated progress feedback with rotating messages while waiting for Claude"
    - "API failures and network errors display friendly error messages with retry option"
    - "Designer can copy full critique text to clipboard with one button click"
  artifacts:
    - path: "src/components/critique-display.tsx"
      provides: "Critique display with 4 sections, expandable points, copy button"
      min_lines: 80
    - path: "src/app/page.tsx"
      provides: "Full app with loading state, error display, critique rendering"
      contains: "CritiqueDisplay"
  key_links:
    - from: "src/app/page.tsx"
      to: "src/components/critique-display.tsx"
      via: "CritiqueDisplay component import and render"
      pattern: "import.*CritiqueDisplay"
    - from: "src/app/page.tsx"
      to: "critiqueResult state"
      via: "Passes critiqueResult prop to CritiqueDisplay"
      pattern: "critique.*=.*critiqueResult"
    - from: "src/components/critique-display.tsx"
      to: "navigator.clipboard"
      via: "Copy button calls writeText"
      pattern: "navigator\\.clipboard\\.writeText"
---

<objective>
Build the critique display UI, loading states, error handling, and copy-to-clipboard — completing the full upload → configure → critique → read flow.

Purpose: This is the final phase. After this, the product is usable end-to-end.
Output: Complete critique display with expandable sections, loading animation, error states, and clipboard copy.
</objective>

<execution_context>
@/Users/georgebagaoisan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/georgebagaoisan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/types/critique.ts
@src/app/page.tsx
@src/components/critique-config.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CritiqueDisplay component with expandable sections and copy button</name>
  <files>src/components/critique-display.tsx</files>
  <action>
Create a CritiqueDisplay component that renders a CritiqueResult as 4 visually distinct sections.

**Props:**
- `critique: CritiqueResult` — the critique data to display
- `onNewCritique: () => void` — callback to reset and start a new critique

**Section rendering (4 sections):**
Each section maps to a CritiqueResult key:
| Key | Title | Icon (from lucide-react) | Color accent |
|-----|-------|--------------------------|--------------|
| `what_works` | What Works | CheckCircle | green-500 |
| `usability_risks` | Usability Risks | AlertTriangle | amber-500 |
| `visual_hierarchy` | Visual Hierarchy Issues | Eye | blue-500 |
| `improvements` | Concrete Improvements | Lightbulb | purple-500 |

**Expandable points (DISP-02):**
Each CritiquePoint in a section shows:
- Summary text as a clickable row (cursor-pointer)
- A small ChevronDown icon that rotates to ChevronUp when expanded
- When clicked, toggles open/closed revealing the `detail` text below with a subtle slide/fade
- Use local component state to track which points are expanded (allow multiple open simultaneously)
- Detail text styled slightly indented, muted color, smaller font

**Copy to clipboard (DISP-05):**
- Add a "Copy Critique" button at the top-right of the component using lucide Copy icon
- On click, format the entire critique as plain text:
  ```
  WHAT WORKS
  - [summary]: [detail]
  - [summary]: [detail]

  USABILITY RISKS
  - [summary]: [detail]
  ...
  ```
- Use `navigator.clipboard.writeText()` to copy
- After copy, change button text to "Copied!" with a Check icon for 2 seconds, then revert

**"New Critique" button:**
- Below all sections, add a button "Start New Critique" that calls `onNewCritique`
- This lets the user reset and upload a new image

**Styling:**
- Each section is a Card with the colored icon and title as header
- Use existing Card component from @/components/ui/card
- Sections stack vertically with gap-4
- Responsive: works on mobile (single column) and desktop
  </action>
  <verify>
Check file exists and exports CritiqueDisplay component:
```bash
grep -n "export function CritiqueDisplay" src/components/critique-display.tsx
```
Verify all 4 sections are rendered:
```bash
grep -c "what_works\|usability_risks\|visual_hierarchy\|improvements" src/components/critique-display.tsx
```
Verify clipboard functionality:
```bash
grep "navigator.clipboard.writeText" src/components/critique-display.tsx
```
  </verify>
  <done>CritiqueDisplay component renders 4 sections with expandable summary→detail points and a working copy-to-clipboard button</done>
</task>

<task type="auto">
  <name>Task 2: Add loading state, error display, and wire CritiqueDisplay into page</name>
  <files>src/app/page.tsx</files>
  <action>
Update page.tsx to complete the end-to-end flow with loading, error, and critique display states.

**Loading state (DISP-03):**
When `isSubmitting` is true, show a loading section below the submit button:
- An animated pulsing card with rotating analysis messages
- Messages cycle every 2.5 seconds using `useEffect` + `setInterval`:
  1. "Analyzing your design..."
  2. "Checking usability patterns..."
  3. "Reviewing visual hierarchy..."
  4. "Crafting improvements..."
- Show a simple CSS spinner (animate-spin on a circular border element, same pattern as upload-zone.tsx)
- Message text centered below the spinner

**Error display (DISP-04):**
Replace the current `<p className="text-sm text-red-600">` with a styled error card:
- Use Card component with red-tinted border/background
- Show an AlertCircle icon (from lucide-react) with the error message
- Add a "Try Again" Button that calls `handleSubmit` to retry
- Handle timeout: add AbortController to the fetch call in handleSubmit with a 30-second timeout. If aborted, show "Request timed out. Please try again." error message

**CritiqueDisplay integration:**
- Import CritiqueDisplay from `@/components/critique-display`
- When `critiqueResult` is not null AND `isSubmitting` is false, render `<CritiqueDisplay critique={critiqueResult} onNewCritique={handleImageRemove} />`
- Place it below the submit area, replacing the upload zone and config when critique is shown
- When critique is displayed, hide the upload zone, config, and submit button (show only the critique)
- The "Start New Critique" button in CritiqueDisplay calls handleImageRemove which resets everything

**Layout adjustment:**
- When critique is displayed, widen the max-w from `max-w-2xl` to `max-w-3xl` to give critique sections room
- Keep the header (DesignCritic title) always visible

**State flow:**
1. No image → show UploadZone
2. Image uploaded → show UploadZone (preview) + CritiqueConfig + Submit button
3. Submitting → show UploadZone (preview) + CritiqueConfig + disabled Submit + Loading animation
4. Error → show UploadZone (preview) + CritiqueConfig + Submit button + Error card
5. Critique ready → show CritiqueDisplay only (hide upload/config/submit)
  </action>
  <verify>
Verify TypeScript compiles:
```bash
cd /Users/georgebagaoisan/Desktop/designcritic && npx tsc --noEmit 2>&1 | head -20
```
Verify CritiqueDisplay is imported and used:
```bash
grep "CritiqueDisplay" src/app/page.tsx
```
Verify loading state messages exist:
```bash
grep "Analyzing your design" src/app/page.tsx
```
Verify AbortController timeout:
```bash
grep "AbortController" src/app/page.tsx
```
  </verify>
  <done>Page renders loading animation during API call, styled error card with retry on failure, and CritiqueDisplay when critique is ready. Full flow works: upload → configure → submit → loading → critique display (or error with retry).</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `npm run build` succeeds
3. All 4 critique sections render with correct titles and icons
4. Clicking a summary bullet expands to show detail text
5. Copy button copies formatted critique text to clipboard
6. Loading animation shows rotating messages during API call
7. Error state shows styled card with retry button
8. "Start New Critique" resets to upload state
</verification>

<success_criteria>
- CritiqueDisplay component exists and renders 4 sections with expandable points
- Copy to clipboard works with formatted plain text
- Loading state shows animated progress with rotating messages
- Error display includes retry functionality
- Full flow works end-to-end: upload → configure → submit → loading → critique (or error → retry)
- TypeScript compiles with no errors
- App builds successfully
</success_criteria>

<output>
After completion, create `.planning/phases/05-display-polish/05-01-SUMMARY.md`
</output>

---
phase: 04-configuration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/page.tsx
  - src/components/critique-config.tsx
autonomous: false

must_haves:
  truths:
    - "Designer can select one industry context from 5 visible options (SaaS, Healthcare, Consumer, Ecommerce, Fintech)"
    - "Designer can select one critique tone from 2 visible options (Constructive, Roast)"
    - "Selected industry and tone are visually distinct (filled/default variant) from unselected options (outline variant)"
    - "Submit button triggers API call to /api/critique with selected context, tone, and uploaded image"
  artifacts:
    - path: "src/components/critique-config.tsx"
      provides: "Industry context selector and tone selector UI components"
      contains: "IndustryContext"
    - path: "src/app/page.tsx"
      provides: "State management for context, tone, and submit flow"
      contains: "selectedContext"
  key_links:
    - from: "src/components/critique-config.tsx"
      to: "src/types/critique.ts"
      via: "import IndustryContext, CritiqueTone types"
      pattern: "import.*IndustryContext.*CritiqueTone"
    - from: "src/app/page.tsx"
      to: "/api/critique"
      via: "fetch POST with image, mediaType, context, tone"
      pattern: "fetch.*api/critique"
---

<objective>
Add industry context and critique tone selection UI with a submit button that wires upload + configuration to the /api/critique endpoint.

Purpose: Designers need to customize their critique before submitting. This phase connects the upload system (Phase 3), AI engine (Phase 2), and configuration into a functional end-to-end flow.
Output: CritiqueConfig component, updated page.tsx with state management and submit wiring.
</objective>

<execution_context>
@/Users/georgebagaoisan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/georgebagaoisan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-configuration/04-RESEARCH.md
@src/types/critique.ts
@src/app/page.tsx
@src/components/upload-zone.tsx
@src/app/api/critique/route.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CritiqueConfig component and wire page state</name>
  <files>src/components/critique-config.tsx, src/app/page.tsx</files>
  <action>
Create `src/components/critique-config.tsx` — a client component with two selector groups:

**Industry Context Selector (CONF-01):**
- Label: "Industry Context" with a brief helper text like "Tailors feedback to your domain"
- 5 buttons in a flex-wrap row for: SaaS, Healthcare, Consumer, Ecommerce, Fintech
- Display labels should be capitalized display names (e.g., "SaaS", "Healthcare", "Consumer", "E-commerce", "Fintech")
- Use existing ShadCN `Button` component with variant toggling:
  - Selected: `variant="default"` (filled, primary color)
  - Unselected: `variant="outline"` (border only)
- Each button onClick calls `onContextChange(value)` prop

**Critique Tone Selector (CONF-02):**
- Label: "Critique Tone"
- 2 buttons: "Constructive" and "Roast"
- Same variant toggling pattern as industry selector
- Each button onClick calls `onToneChange(value)` prop

**Component Props Interface:**
```typescript
interface CritiqueConfigProps {
  selectedContext: IndustryContext;
  selectedTone: CritiqueTone;
  onContextChange: (context: IndustryContext) => void;
  onToneChange: (tone: CritiqueTone) => void;
}
```

Import `IndustryContext` and `CritiqueTone` from `@/types/critique`. Import `Button` from `@/components/ui/button`.

Use Tailwind for spacing: `space-y-6` between the two groups, `gap-2` and `flex-wrap` for the button rows. Section labels should be `text-sm font-medium text-muted-foreground`.

**Update `src/app/page.tsx`:**
- Import `IndustryContext`, `CritiqueTone` from `@/types/critique`
- Import `CritiqueConfig` from `@/components/critique-config`
- Add state: `const [selectedContext, setSelectedContext] = useState<IndustryContext>('saas')`
- Add state: `const [selectedTone, setSelectedTone] = useState<CritiqueTone>('constructive')`
- Add state: `const [isSubmitting, setIsSubmitting] = useState(false)`
- Add state: `const [critiqueResult, setCritiqueResult] = useState<CritiqueResult | null>(null)` (import CritiqueResult from types)
- Add state: `const [error, setError] = useState<string | null>(null)`
- Render `<CritiqueConfig>` below the `<UploadZone>` component, only when `uploadedImage` is not null (configuration appears after upload)
- Add a submit `<Button>` below the config section (also only when uploadedImage is not null):
  - Text: "Get Critique" (or "Analyzing..." when submitting)
  - `disabled={isSubmitting || !uploadedImage}`
  - `className="w-full"` and `size="lg"` for prominent placement
  - onClick triggers `handleSubmit` function
- Add `handleSubmit` async function:
  1. Set `setIsSubmitting(true)`, `setError(null)`
  2. Call `fetch('/api/critique', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ image: uploadedImage.base64, mediaType: uploadedImage.mediaType, context: selectedContext, tone: selectedTone }) })`
  3. Parse response JSON
  4. If `!response.ok`, set error from response body `error` field
  5. If ok, set `setCritiqueResult(data.critique)` (Phase 5 will display this — for now just store it)
  6. Finally: `setIsSubmitting(false)`
- When `handleImageRemove` is called, also reset: `setCritiqueResult(null)`, `setError(null)`
- Display error below submit button if error state exists: red text, `text-sm text-red-600`
- Wrap configuration + submit in a `space-y-6` container with `mt-6` margin from upload zone

Layout order in JSX (all within the existing max-w-2xl main):
1. CardHeader (title + description) — existing
2. UploadZone — existing
3. CritiqueConfig — new (conditional on uploadedImage)
4. Submit Button — new (conditional on uploadedImage)
5. Error message — new (conditional on error)
  </action>
  <verify>
Run `npx tsc --noEmit` from project root — no type errors. Verify `src/components/critique-config.tsx` exists. Verify `src/app/page.tsx` imports CritiqueConfig and has selectedContext/selectedTone state.
  </verify>
  <done>
CritiqueConfig renders 5 industry buttons + 2 tone buttons with visual toggle. Page manages context/tone/submit state. Submit button calls /api/critique with all parameters. Configuration section only appears after image upload.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify configuration UI and submit flow</name>
  <files>src/app/page.tsx, src/components/critique-config.tsx</files>
  <action>
Human verification of the configuration UI and submit flow. No automated action — this is a visual/functional checkpoint.

What was built: Industry context selector (5 options), critique tone selector (2 options), and submit button wired to /api/critique endpoint. Configuration appears after uploading an image.
  </action>
  <verify>
1. Run `npm run dev` and open http://localhost:3000
2. Confirm only the upload zone is visible initially (no config selectors)
3. Upload any UI screenshot (PNG/JPG/WebP)
4. After upload, verify:
   a. Industry context section appears with 5 buttons: SaaS, Healthcare, Consumer, E-commerce, Fintech
   b. SaaS is pre-selected (filled/primary style), others are outline
   c. Click "Healthcare" — it becomes filled, SaaS becomes outline
   d. Critique tone section appears with 2 buttons: Constructive, Roast
   e. Constructive is pre-selected (filled), Roast is outline
   f. Click "Roast" — it becomes filled, Constructive becomes outline
5. Verify "Get Critique" submit button is visible and enabled
6. If ANTHROPIC_API_KEY is configured in .env.local:
   a. Click "Get Critique" — button shows "Analyzing..." while loading
   b. After response, no errors displayed (critique result stored internally for Phase 5)
7. If no API key: click submit, verify a user-friendly error message appears (not a stack trace)
8. Remove the image (X button) and verify config section + submit button disappear
  </verify>
  <done>User types "approved" or describes issues. All 5 industry options selectable, both tones selectable, visual toggle works, submit triggers API call.</done>
</task>

</tasks>

<verification>
- [ ] `npx tsc --noEmit` passes with no errors
- [ ] `npm run build` completes successfully
- [ ] CritiqueConfig component renders industry (5) and tone (2) selectors
- [ ] Selected options use `variant="default"`, unselected use `variant="outline"`
- [ ] Submit button sends POST to /api/critique with correct payload shape
- [ ] Configuration only visible after image upload
- [ ] Removing image resets configuration visibility
</verification>

<success_criteria>
1. Designer can select one industry context from 5 visible button options
2. Designer can select one critique tone from 2 visible button options
3. Selected configuration is visually distinct (filled button vs outline) before submission
4. Submit button triggers real API call with image + context + tone
5. TypeScript compilation passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-configuration/04-01-SUMMARY.md`
</output>
